<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yakrel's Homelab Infrastructure</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0d1117;
            --bg-sidebar: #161b22;
            --bg-card: #161b22;
            --border: #30363d;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-orange: #d29922;
            --accent-purple: #a371f7;
            --accent-red: #ff7b72;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 100;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .profile-img {
            width: 50px;
            height: 50px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
        }

        .brand-text h3 { margin: 0; font-size: 1rem; color: var(--text-main); }
        .brand-text p { margin: 3px 0 0 0; font-size: 0.75rem; color: var(--text-muted); }

        .nav-links { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 5px; }
        .nav-item {
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-muted);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(88, 166, 255, 0.1);
            color: var(--accent-blue);
        }
        .nav-item i { width: 20px; text-align: center; }

        /* --- MAIN CONTENT --- */
        .main-content {
            margin-left: 280px;
            padding: 40px 60px;
            width: 100%;
            max-width: 1200px;
            position: relative;
        }

        /* --- LANG SWITCHER --- */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 40px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .lang-switch:hover { border-color: var(--accent-blue); color: var(--text-main); }
        .lang-active { color: var(--accent-blue); font-weight: bold; }

        section { margin-bottom: 80px; scroll-margin-top: 40px; }

        h1 { font-size: 2.5rem; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        h2 { font-size: 1.8rem; color: var(--text-main); margin-top: 0; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        h2 i { color: var(--accent-blue); font-size: 1.4rem; }
        
        p { line-height: 1.7; color: var(--text-muted); margin-bottom: 20px; }

        /* CODE BLOCKS */
        .code-block {
            background: #1e1e1e; /* VS Code dark like */
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            color: #d4d4d4;
            overflow-x: auto;
            position: relative;
            margin-bottom: 20px;
        }
        .code-lang {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--border);
            padding: 2px 8px;
            border-bottom-left-radius: 8px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        .c-cmd { color: #dcdcaa; }
        .c-arg { color: #9cdcfe; }
        .c-comment { color: #6a9955; }
        .c-str { color: #ce9178; }

        /* CARDS FOR FEATURES */
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 8px;
        }
        .feature-title { font-weight: bold; margin-bottom: 10px; display: block; color: var(--text-main); }
        .feature-desc { font-size: 0.85rem; color: var(--text-muted); }

        /* --- NETWORK TOPOLOGY (Imported) --- */
        .topology-container {
            background: rgba(13, 17, 23, 0.5);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 40px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 40px;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .node-card {
            background: rgba(22, 27, 34, 0.9);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 140px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: all 0.3s;
            z-index: 2;
        }
        .node-card:hover { transform: translateY(-5px); border-color: var(--accent-blue); }
        .node-icon { font-size: 1.5rem; margin-bottom: 5px; }
        .layer { display: flex; justify-content: center; gap: 40px; }
        .c-cloud { border-top: 3px solid var(--accent-blue); }
        .c-edge { border-top: 3px solid var(--accent-orange); }
        .c-infra { border-top: 3px solid var(--accent-purple); }
        
        /* --- INVENTORY GRID (JS Target) --- */
        #stack-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .inv-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .inv-card:hover { transform: translateY(-3px); border-color: var(--text-muted); }
        .inv-header { padding: 15px; background: rgba(255,255,255,0.02); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .inv-body { padding: 15px; }
        .svc-row { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 8px; color: var(--text-muted); }
        .svc-row i { width: 20px; text-align: center; margin-right: 5px; }
        
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; background: var(--border); }
        .badge.gpu { background: #76b900; color: black; }

        /* --- SCREENSHOTS --- */
        .screenshot-container {
            margin-top: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: #000;
        }
        .screenshot-container img {
            width: 100%;
            display: block;
            opacity: 0.9;
            transition: opacity 0.3s;
        }
        .screenshot-container img:hover { opacity: 1; }
        .screenshot-caption {
            background: var(--bg-card);
            padding: 10px;
            font-size: 0.75rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            text-align: center;
        }

        /* --- LIGHTBOX --- */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            animation: fadeIn 0.3s;
        }
        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: zoomIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.9); } to { transform: scale(1); } }

        .screenshot-container img {
            cursor: zoom-in; /* Indicate clickable */
        }

        /* --- TOOLTIPS --- */
        .tooltip {
            border-bottom: 1px dotted var(--accent-blue);
            cursor: help;
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }
        .tooltip:hover::before { /* Arrow */
            content: "";
            position: absolute;
            bottom: 115%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0,0,0,0.9) transparent transparent transparent;
            z-index: 1000;
        }

        @media (max-width: 900px) {
            .sidebar { display: none; } /* Mobile todo: Hamburger */
            .main-content { margin-left: 0; padding: 20px; }
            .lang-switch { right: 20px; }
        }

    </style>
</head>
<body>

    <!-- SIDEBAR NAV -->
    <nav class="sidebar">
        <div class="profile-section">
            <div class="profile-img">BY</div>
            <div class="brand-text">
                <h3>Berkay Yetgin</h3>
                <p>System Administrator</p>
            </div>
        </div>

        <ul class="nav-links">
            <li><a href="#overview" class="nav-item active"><i class="fa-solid fa-house"></i> <span data-i18n="nav_overview">Overview</span></a></li>
            <li><a href="#iac" class="nav-item"><i class="fa-solid fa-code"></i> <span data-i18n="nav_iac">Infrastructure as Code</span></a></li>
            <li><a href="#security" class="nav-item"><i class="fa-solid fa-shield-halved"></i> <span data-i18n="nav_security">Security & Secrets</span></a></li>
            <li><a href="#backup" class="nav-item"><i class="fa-solid fa-floppy-disk"></i> <span data-i18n="nav_backup">Backup & Recovery</span></a></li>
            <li><a href="#observability" class="nav-item"><i class="fa-solid fa-chart-line"></i> <span data-i18n="nav_observability">Observability</span></a></li>
            <li><a href="#topology" class="nav-item"><i class="fa-solid fa-network-wired"></i> <span data-i18n="nav_topology">Network Topology</span></a></li>
            <li><a href="#virtualization" class="nav-item"><i class="fa-brands fa-docker"></i> <span data-i18n="nav_virtualization">Virtualization Strategy</span></a></li>
            <li><a href="#inventory" class="nav-item"><i class="fa-solid fa-server"></i> <span data-i18n="nav_inventory">Live Inventory</span></a></li>
        </ul>

        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); font-size: 0.75rem; color: var(--text-muted);">
            <p>Last Update: Dec 2025</p>
            <p><a href="https://github.com/Yakrel/proxmox-homelab-automation" target="_blank" style="color:var(--accent-blue); text-decoration:none;">View on GitHub</a></p>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content"> 
        
        <!-- LANGUAGE SWITCHER -->
        <div class="lang-switch" onclick="toggleLanguage()">
            <i class="fa-solid fa-language"></i>
            <span id="lang-text">EN / TR</span>
        </div>

        <!-- 1. OVERVIEW -->
        <section id="overview">
            <div style="background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(163, 113, 247, 0.1)); padding: 40px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 40px;">
                <h1 style="border:none; margin:0;" data-i18n="hero_title">Proxmox Homelab Automation</h1>
                <p style="font-size: 1.1rem; color: var(--text-main); margin-top: 10px;" data-i18n="hero_desc">
                    My personal homelab where I simulate a production environment. 40+ Docker containers, custom Bash automation, and enterprise-grade security. It's not just a hobby, it's my practice ground.
                </p>
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <span class="badge" style="background:var(--accent-blue); color:black;"><i class="fa-brands fa-docker"></i> 40+ Services</span>
                    <span class="badge" style="background:var(--accent-purple); color:black;"><i class="fa-solid fa-code"></i> <span class="tooltip" data-tip="Modular scripts ensuring reproducible deployments (Idempotency)">Bash IaC</span></span>
                    <span class="badge" style="background:var(--accent-green); color:black;"><i class="fa-solid fa-shield"></i> <span class="tooltip" data-tip="AES-256-CBC encryption via OpenSSL for .env files">OpenSSL Encrypted</span></span>
                </div>

                <!-- Main Dashboard Screenshot -->
                <div class="screenshot-container">
                    <img src="assets/main-dashboard.png" alt="Homepage Dashboard">
                    <div class="screenshot-caption">
                        <strong data-i18n="img_dash_title">Centralized Command Center:</strong> <span data-i18n="img_dash_desc">My main dashboard. I use this to check service health and disk usage at a glance.</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-rotate" style="color:var(--accent-blue)"></i> <span data-i18n="feat_cd_title">Continuous Delivery</span></span>
                    <span class="feature-desc" data-i18n="feat_cd_desc">When I push code, GitHub Actions builds my Docker images. I also set up automated hooks to sync backups to Google Drive.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-user-shield" style="color:var(--accent-orange)"></i> <span data-i18n="feat_zt_title">Zero Trust Access</span></span>
                    <span class="feature-desc" data-i18n="feat_zt_desc">I don't open ports to the internet. Access is handled via Cloudflare Tunnels, protected by Email OTPs.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-microchip" style="color:var(--accent-green)"></i> <span data-i18n="feat_hw_title">Hardware Passthrough</span></span>
                    <span class="feature-desc" data-i18n="feat_hw_desc">My media server needs GPU power. I mapped the NVIDIA card directly to the LXC container using cgroups.</span>
                </div>
            </div>
        </section>

        <!-- 2. IAC & AUTOMATION -->
        <section id="iac">
            <h2><i class="fa-solid fa-terminal"></i> <span data-i18n="iac_title">Infrastructure as Code</span></h2>
            <p data-i18n="iac_intro">I didn't want to configure servers manually every time. So, I built a setup where I define everything in one YAML file (<code>stacks.yaml</code>), and my scripts handle the installation automatically.</p>
            
            <div class="feature-grid" style="margin-bottom: 20px;">
                <div class="feature-card">
                    <span class="feature-title" data-i18n="iac_ssot_title">Single Source of Truth</span>
                    <span class="feature-desc" data-i18n="iac_ssot_desc">I manage all my containers and networks in <code>stacks.yaml</code>. If it's not in that file, it doesn't exist on the server.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-title" data-i18n="iac_idem_title">Idempotency</span>
                    <span class="feature-desc" data-i18n="iac_idem_desc">I can run my installer script 10 times, and it won't break anything. It only applies changes if something is missing.</span>
                </div>
            </div>

            <!-- CLI Screenshot -->
            <div class="screenshot-container" style="margin-bottom: 20px;">
                <img src="assets/automation-cli.png" alt="Interactive CLI Installer">
                <div class="screenshot-caption">
                    <strong data-i18n="img_cli_title">Interactive Automation:</strong> <span data-i18n="img_cli_desc">The <code>installer.sh</code> script reading from <code>stacks.yaml</code> to provision resources.</span>
                </div>
            </div>

            <div class="code-block">
                <span class="code-lang">deploy-stack.sh</span>
                <div style="line-height: 1.5;">
<span class="c-comment"># Example: Atomic deployment with secret decryption</span>
<span class="c-cmd">function</span> <span class="c-arg">deploy_stack()</span> {
    <span class="c-cmd">local</span> stack_name=$1
    
    <span class="c-comment"># 1. Decrypt secrets in memory only (OpenSSL AES-256-CBC)</span>
    <span class="c-cmd">printf</span> '%s' "$MASTER_KEY" | \
        <span class="c-cmd">openssl</span> enc -d -aes-256-cbc -pbkdf2 -salt -pass stdin \
        -in .env.enc -out .env
        
    <span class="c-comment"># 2. Pull & Deploy</span>
    <span class="c-cmd">docker</span> compose pull
    <span class="c-cmd">docker</span> compose up -d --remove-orphans
    
    <span class="c-comment"># 3. Cleanup secrets immediately</span>
    <span class="c-cmd">rm</span> -f .env
}
                </div>
            </div>
        </section>

        <!-- 3. SECURITY -->
        <section id="security">
            <h2><i class="fa-solid fa-lock"></i> <span data-i18n="sec_title">Security & Secrets Management</span></h2>
            <p data-i18n="sec_intro">I treat this homelab like a real production server. No open ports to the outside world, and all my API keys are encrypted in the repo so I don't accidentally leak them.</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-title" data-i18n="sec_enc_title">AES-256 Encryption (OpenSSL)</span>
                    <span class="feature-desc" data-i18n="sec_enc_desc">I store sensitive keys as <code>.env.enc</code> in Git. They are encrypted with OpenSSL, so even if the repo is public, the secrets are safe.</span>
                </div>
                <div class="feature-card">
                    <span class="feature-title" data-i18n="sec_f2b_title">Fail2Ban Integration</span>
                    <span class="feature-desc" data-i18n="sec_f2b_desc">Even though I use Cloudflare, I also run Fail2Ban locally to block anyone trying to brute-force my internal services.</span>
                </div>
            </div>
        </section>

        <!-- 3.1 BACKUP & DR -->
        <section id="backup">
            <h2><i class="fa-solid fa-floppy-disk"></i> <span data-i18n="backup_title">Backup & Disaster Recovery</span></h2>
            <p data-i18n="backup_intro">I use a mix of local snapshots for quick fixes and encrypted cloud backups for real disasters. If the server dies, my data survives.</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-clock-rotate-left" style="color:var(--accent-green)"></i> <span data-i18n="backup_l1_title">Layer 1: Local ZFS Snapshots</span></span>
                    <span class="feature-desc" data-i18n="backup_l1_desc">
                        Managed by <strong>Sanoid</strong>. If I accidentally delete a file, I can roll back in seconds using ZFS snapshots.
                    </span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-brands fa-google-drive" style="color:var(--accent-blue)"></i> <span data-i18n="backup_l2_title">Layer 2: Off-Site Archival</span></span>
                    <span class="feature-desc" data-i18n="backup_l2_desc">
                        I use <strong>Restic</strong> to send encrypted backups to Google Drive. It only sends the changes (deduplication), so it saves space and bandwidth.
                    </span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-box-archive" style="color:var(--accent-orange)"></i> <span data-i18n="backup_l3_title">Layer 3: Infrastructure Code</span></span>
                    <span class="feature-desc" data-i18n="backup_l3_desc">
                        Since my setup is code, I can rebuild the whole server from scratch just by running my <code>installer.sh</code> script.
                    </span>
                </div>
            </div>
        </section>

        <!-- 3.5 OBSERVABILITY -->
        <section id="observability">
            <h2><i class="fa-solid fa-chart-line"></i> <span data-i18n="obs_title">Observability & Logs</span></h2>
            <p data-i18n="obs_intro">I hate logging into servers one by one just to check if they are running. I set up a monitoring stack to see everything in one place.</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-fire" style="color:var(--accent-orange)"></i> Prometheus & Node Exporter</span>
                    <span class="feature-desc" data-i18n="obs_prom_desc">
                        Collects metrics from Proxmox and Docker. If disk usage goes high or a service goes down, I get an alert.
                    </span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-list" style="color:var(--accent-blue)"></i> Loki (Log Aggregation)</span>
                    <span class="feature-desc" data-i18n="obs_loki_desc">
                        Instead of using <code>tail -f</code> on every server, I send all logs to Loki. I can search through them easily in Grafana.
                    </span>
                </div>
                <div class="feature-card">
                    <span class="feature-title"><i class="fa-solid fa-table-columns" style="color:var(--accent-green)"></i> Grafana Dashboards</span>
                    <span class="feature-desc" data-i18n="obs_graf_desc">
                        My central dashboard for visualizing hardware stats, network traffic, and application health.
                    </span>
                </div>
            </div>

            <!-- Grafana Screenshot -->
            <div class="screenshot-container">
                <img src="assets/grafana-metrics.png" alt="Grafana Dashboard">
                <div class="screenshot-caption">
                    <strong data-i18n="img_graf_title">Operational Visibility:</strong> <span data-i18n="img_graf_desc">Real-time monitoring of Proxmox host resources (CPU/RAM) and individual LXC container performance.</span>
                </div>
            </div>
        </section>

        <!-- 4. NETWORK TOPOLOGY -->
        <section id="topology">
            <h2><i class="fa-solid fa-network-wired"></i> <span data-i18n="topo_title">Network Topology</span></h2>
            <p data-i18n="topo_intro">I set up a hybrid network. My family accesses services locally (fast), while I access them securely from outside using Cloudflare Tunnels.</p>
            
            <!-- REUSED TOPOLOGY DIAGRAM -->
            <div class="topology-container" style="align-items: center; gap: 10px;">
                <!-- Layers -->
                <div class="layer" style="width:100%; justify-content: space-around;">
                    <div class="node-card c-cloud">
                        <i class="fa-solid fa-globe node-icon" style="color:var(--accent-blue)"></i>
                        <span style="font-weight:bold;">Public Internet</span>
                        <span style="font-size:0.7rem; color:var(--text-muted);">*.byetgin.com</span>
                    </div>
                    <div class="node-card c-edge">
                        <i class="fa-solid fa-mobile-screen node-icon" style="color:var(--accent-orange)"></i>
                        <span style="font-weight:bold;">Roaming Device</span>
                        <span style="font-size:0.7rem; color:var(--text-muted);">WARP VPN</span>
                    </div>
                </div>

                <div style="display:flex; justify-content:center; width:100%;">
                    <i class="fa-solid fa-arrow-down" style="color:var(--text-muted);"></i>
                </div>

                <!-- Tunnel -->
                <div style="background:var(--bg-card); border:1px solid var(--accent-purple); padding:10px 30px; border-radius:30px; color:var(--accent-purple); font-size:0.9rem;">
                    <i class="fa-solid fa-lock"></i> <span data-i18n="topo_tunnel">Encrypted Cloudflare Tunnel (No Inbound WAN Ports)</span>
                </div>

                <div style="display:flex; justify-content:center; width:100%;">
                    <i class="fa-solid fa-arrow-down" style="color:var(--text-muted);"></i>
                </div>

                <!-- Gateway -->
                <div class="node-card c-infra" style="width: 100%; max-width: 500px; flex-direction: row; justify-content: space-around;">
                    <div style="text-align:center;">
                        <i class="fa-brands fa-cloudflare node-icon"></i>
                        <div>cloudflared</div>
                    </div>
                    <div style="font-family:monospace; font-size:0.7rem; color:var(--text-muted);">TO REVERSE PROXY &rarr;</div>
                    <div style="text-align:center;">
                        <i class="fa-solid fa-shuffle node-icon" style="color:var(--accent-green)"></i>
                        <div>Nginx Proxy</div>
                    </div>
                </div>
            </div>

            <!-- NPM Screenshot -->
            <div class="screenshot-container">
                <img src="assets/proxy-routing.png" alt="Nginx Proxy Manager">
                <div class="screenshot-caption">
                    <strong data-i18n="img_npm_title">Traffic Routing:</strong> <span data-i18n="img_npm_desc">Nginx Proxy Manager handling SSL termination and routing public subdomains to internal container IPs.</span>
                </div>
            </div>
        </section>

        <!-- 5. VIRTUALIZATION -->
        <section id="virtualization">
            <h2><i class="fa-brands fa-docker"></i> <span data-i18n="virt_title">Virtualization Strategy</span></h2>
            <p data-i18n="virt_intro">I use LXC for things that need to act like full operating systems, and Docker for running apps. My scripts handle the complex config to make them work together.</p>
            
            <div class="feature-grid" style="margin-bottom:20px;">
                <div class="feature-card">
                    <span class="feature-title" data-i18n="virt_dind_title">Docker inside LXC (Automated)</span>
                    <span class="feature-desc" data-i18n="virt_dind_desc">
                        My <code>lxc-manager.sh</code> script automatically configures the container settings (nesting, keys) so I can run Docker inside LXC without issues.
                    </span>
                </div>
                <div class="feature-card">
                    <span class="feature-title" data-i18n="virt_gpu_title">Automated GPU Passthrough</span>
                    <span class="feature-desc" data-i18n="virt_gpu_desc">
                        Instead of editing config files manually, my script detects the NVIDIA card and injects the right permissions into the LXC config automatically.
                    </span>
                </div>
            </div>

            <div class="code-block">
                <span class="code-lang">lxc-manager.sh (Snippet)</span>
                <div style="line-height: 1.5;">
<span class="c-comment"># Programmatic Injection of GPU Rules</span>
<span class="c-cmd">gpu_passthrough_lines</span>=(
    <span class="c-str">'lxc.cgroup2.devices.allow: c 195:* rwm'</span>  <span class="c-comment"># NVIDIA GPU</span>
    <span class="c-str">'lxc.cgroup2.devices.allow: c 510:* rwm'</span>  <span class="c-comment"># nvidia-uvm</span>
    <span class="c-str">'lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create=file'</span>
)

<span class="c-cmd">for</span> line in <span class="c-str">"${gpu_passthrough_lines[@]}"</span>; <span class="c-cmd">do</span>
    <span class="c-cmd">if</span> ! <span class="c-cmd">grep</span> -Fxq <span class="c-str">"$line"</span> <span class="c-str">"$LXC_CONFIG_PATH"</span>; <span class="c-cmd">then</span>
        <span class="c-cmd">echo</span> <span class="c-str">"$line"</span> >> <span class="c-str">"$LXC_CONFIG_PATH"</span>
    <span class="c-cmd">fi</span>
<span class="c-cmd">done</span>
                </div>
            </div>
        </section>

        <!-- 6. LIVE INVENTORY -->
        <section id="inventory">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2><i class="fa-solid fa-server"></i> <span data-i18n="inv_title">Live Inventory</span></h2>
                <div style="font-size:0.8rem; color:var(--text-muted);"><i class="fa-solid fa-circle" style="color:var(--accent-green); font-size:0.6rem;"></i> <span data-i18n="inv_status">Systems Operational</span></div>
            </div>
            
            <!-- JS INJECTED GRID -->
            <div id="stack-grid">
                <div style="text-align:center; padding:40px; color:var(--text-muted); grid-column:1/-1;">
                    Loading infrastructure data...
                </div>
            </div>
        </section>

    </main>

    <!-- DATA SOURCE -->
    <script src="architecture-data.js"></script>
    
    <!-- LIGHTBOX OVERLAY -->
    <div id="lightbox" class="lightbox">
        <img id="lightbox-img" src="" alt="Zoomed Screenshot">
    </div>

    <script>
        // --- I18N CONFIGURATION ---
        const I18N = {
            en: {
                nav_overview: "Overview",
                nav_iac: "Infrastructure as Code",
                nav_security: "Security & Secrets",
                nav_backup: "Backup & Recovery",
                nav_observability: "Observability",
                nav_topology: "Network Topology",
                nav_virtualization: "Virtualization Strategy",
                nav_inventory: "Live Inventory",
                
                hero_title: "Proxmox Homelab Automation",
                hero_desc: "My personal homelab where I simulate a production environment. 40+ Docker containers, custom Bash automation, and enterprise-grade security. It's not just a hobby, it's my practice ground.",
                
                img_dash_title: "Centralized Command Center:",
                img_dash_desc: "My main dashboard. I use this to check service health and disk usage at a glance.",
                
                feat_cd_title: "Continuous Delivery",
                feat_cd_desc: "When I push code, GitHub Actions builds my Docker images. I also set up automated hooks to sync backups to Google Drive.",
                
                feat_zt_title: "Zero Trust Access",
                feat_zt_desc: "I don't open ports to the internet. Access is handled via Cloudflare Tunnels, protected by Email OTPs.",
                
                feat_hw_title: "Hardware Passthrough",
                feat_hw_desc: "My media server needs GPU power. I mapped the NVIDIA card directly to the LXC container using cgroups.",
                
                iac_title: "Infrastructure as Code",
                iac_intro: "I didn't want to configure servers manually every time. So, I built a setup where I define everything in one YAML file (<code>stacks.yaml</code>), and my scripts handle the installation automatically.",
                
                iac_ssot_title: "Single Source of Truth",
                iac_ssot_desc: "I manage all my containers and networks in <code>stacks.yaml</code>. If it's not in that file, it doesn't exist on the server.",
                
                iac_idem_title: "Idempotency",
                iac_idem_desc: "I can run my installer script 10 times, and it won't break anything. It only applies changes if something is missing.",
                
                img_cli_title: "Interactive Automation:",
                img_cli_desc: "The <code>installer.sh</code> script reading from <code>stacks.yaml</code> to provision resources.",
                
                sec_title: "Security & Secrets Management",
                sec_intro: "I treat this homelab like a real production server. No open ports to the outside world, and all my API keys are encrypted in the repo so I don't accidentally leak them.",
                
                sec_enc_title: "AES-256 Encryption (OpenSSL)",
                sec_enc_desc: "I store sensitive keys as <code>.env.enc</code> in Git. They are encrypted with OpenSSL, so even if the repo is public, the secrets are safe.",
                
                sec_f2b_title: "Fail2Ban Integration",
                sec_f2b_desc: "Even though I use Cloudflare, I also run Fail2Ban locally to block anyone trying to brute-force my internal services.",

                backup_title: "Backup & Disaster Recovery",
                backup_intro: "I use a mix of local snapshots for quick fixes and encrypted cloud backups for real disasters. If the server dies, my data survives.",
                
                backup_l1_title: "Layer 1: Local ZFS Snapshots",
                backup_l1_desc: "Managed by <strong>Sanoid</strong>. If I accidentally delete a file, I can roll back in seconds using ZFS snapshots.",
                
                backup_l2_title: "Layer 2: Off-Site Archival",
                backup_l2_desc: "I use <strong>Restic</strong> to send encrypted backups to Google Drive. It only sends the changes (deduplication), so it saves space and bandwidth.",
                
                backup_l3_title: "Layer 3: Infrastructure Code",
                backup_l3_desc: "Since my setup is code, I can rebuild the whole server from scratch just by running my <code>installer.sh</code> script.",

                obs_title: "Observability & Logs",
                obs_intro: "I hate logging into servers one by one just to check if they are running. I set up a monitoring stack to see everything in one place.",
                
                obs_prom_desc: "Collects metrics from Proxmox and Docker. If disk usage goes high or a service goes down, I get an alert.",
                
                obs_loki_desc: "Instead of using <code>tail -f</code> on every server, I send all logs to Loki. I can search through them easily in Grafana.",
                
                obs_graf_desc: "My central dashboard for visualizing hardware stats, network traffic, and application health.",
                
                img_graf_title: "Operational Visibility:",
                img_graf_desc: "Real-time monitoring of Proxmox host resources (CPU/RAM) and individual LXC container performance.",

                topo_title: "Network Topology",
                topo_intro: "I set up a hybrid network. My family accesses services locally (fast), while I access them securely from outside using Cloudflare Tunnels.",
                
                topo_tunnel: "Encrypted Cloudflare Tunnel (No Inbound WAN Ports)",
                
                img_npm_title: "Traffic Routing:",
                img_npm_desc: "Nginx Proxy Manager handling SSL termination and routing public subdomains to internal container IPs.",

                virt_title: "Virtualization Strategy",
                virt_intro: "I use LXC for things that need to act like full operating systems, and Docker for running apps. My scripts handle the complex config to make them work together.",
                
                virt_dind_title: "Docker inside LXC (Automated)",
                virt_dind_desc: "My <code>lxc-manager.sh</code> script automatically configures the container settings (nesting, keys) so I can run Docker inside LXC without issues.",
                
                virt_gpu_title: "Automated GPU Passthrough",
                virt_gpu_desc: "Instead of editing config files manually, my script detects the NVIDIA card and injects the right permissions into the LXC config automatically.",

                inv_title: "Live Inventory",
                inv_status: "Systems Operational"
            },
            tr: {
                nav_overview: "Genel Bakış",
                nav_iac: "Kod Olarak Altyapı",
                nav_security: "Güvenlik & Sırlar",
                nav_backup: "Yedekleme & Kurtarma",
                nav_observability: "Gözlenebilirlik",
                nav_topology: "Ağ Topolojisi",
                nav_virtualization: "Sanallaştırma Stratejisi",
                nav_inventory: "Canlı Envanter",
                
                hero_title: "Proxmox Ev Laboratuvarı Otomasyonu",
                hero_desc: "Üretim ortamı simülasyonu yaptığım kişisel laboratuvarım. 40+ Docker konteyneri, kendi yazdığım otomasyon scriptleri ve kurumsal seviye güvenlik. Bu sadece bir hobi değil, benim antrenman saham.",
                
                img_dash_title: "Merkezi Komuta Merkezi:",
                img_dash_desc: "Ana paneli kullanarak servislerin sağlığını ve disk durumunu tek bakışta kontrol ediyorum.",
                
                feat_cd_title: "Sürekli Dağıtım (CD)",
                feat_cd_desc: "Kod yüklediğimde GitHub Actions imajlarımı derler. Ayrıca yedekleri Google Drive'a eşitlemek için otomatik tetikleyiciler kurdum.",
                
                feat_zt_title: "Sıfır Güven Erişimi",
                feat_zt_desc: "İnternete açık port bırakmıyorum. Erişimi, E-posta OTP korumalı Cloudflare Tünelleri üzerinden sağlıyorum.",
                
                feat_hw_title: "Donanım Passthrough",
                feat_hw_desc: "Medya sunucum için GPU gücü lazım. NVIDIA kartını LXC konteynerine doğrudan bağlamak için gerekli ayarları script ile yaptım.",
                
                iac_title: "Kod Olarak Altyapı (IaC)",
                iac_intro: "Sunucuları her seferinde elle kurmak istemedim. Bu yüzden her şeyi tek bir YAML dosyasında (<code>stacks.yaml</code>) tanımladığım ve scriptlerin kurulumu otomatik yaptığı bir yapı kurdum.",
                
                iac_ssot_title: "Tek Gerçeklik Kaynağı",
                iac_ssot_desc: "Tüm konteyner ve ağlarımı <code>stacks.yaml</code> dosyasından yönetiyorum. Eğer o dosyada yoksa, sunucuda da yoktur.",
                
                iac_idem_title: "Tekrar Edilebilirlik",
                iac_idem_desc: "Kurulum scriptimi 10 kere de çalıştırsam sistem bozulmaz. Sadece eksik veya değişmiş bir şey varsa onu düzeltir.",
                
                img_cli_title: "İnteraktif Otomasyon:",
                img_cli_desc: "<code>installer.sh</code> scripti <code>stacks.yaml</code> dosyasını okuyarak kaynakları provizyonlarken.",
                
                sec_title: "Güvenlik ve Sır Yönetimi",
                sec_intro: "Bu laboratuvarı gerçek bir sunucu gibi yönetiyorum. Dışarıya açık portum yok ve tüm şifrelerimi repoda şifreli tutuyorum, böylece kazara sızdırma riskim olmuyor.",
                
                sec_enc_title: "AES-256 Şifreleme (OpenSSL)",
                sec_enc_desc: "Hassas anahtarları Git'te <code>.env.enc</code> olarak tutuyorum. OpenSSL ile şifreli oldukları için repo halka açık olsa bile şifrelerim güvende.",
                
                sec_f2b_title: "Fail2Ban Entegrasyonu",
                sec_f2b_desc: "Cloudflare kullansam bile, iç ağda birisi kaba kuvvet (brute-force) denerse diye Fail2Ban ile yerel koruma da sağlıyorum.",

                backup_title: "Yedekleme ve Felaket Kurtarma",
                backup_intro: "Hızlı düzeltmeler için yerel snapshotları, gerçek felaketler için şifreli bulut yedeklerini kullanıyorum. Sunucu yansa bile verim güvende.",
                
                backup_l1_title: "Katman 1: Yerel ZFS Snapshot",
                backup_l1_desc: "<strong>Sanoid</strong> kullanıyorum. Yanlışlıkla bir dosya silersem, ZFS snapshotları sayesinde saniyeler içinde geri getirebiliyorum.",
                
                backup_l2_title: "Katman 2: Uzak Arşivleme",
                backup_l2_desc: "Şifreli yedekleri Google Drive'a göndermek için <strong>Restic</strong> kullanıyorum. Sadece değişen veriyi gönderdiği (deduplication) için hem yer hem hız kazanıyorum.",
                
                backup_l3_title: "Katman 3: Altyapı Kodu",
                backup_l3_desc: "Kurulumum kod tabanlı olduğu için, tüm sunucuyu sadece <code>installer.sh</code> scriptini çalıştırarak sıfırdan kurabilirim.",

                obs_title: "Gözlenebilirlik ve Loglar",
                obs_intro: "Sadece çalışıyorlar mı diye sunuculara tek tek girmekten hoşlanmıyorum. Her şeyi tek yerden görebilmek için bir izleme sistemi kurdum.",
                
                obs_prom_desc: "Proxmox ve Docker verilerini toplar. Disk dolarsa veya bir servis çökerse bana hemen uyarı gelir.",
                
                obs_loki_desc: "Her sunucuda <code>tail -f</code> yapmak yerine logları Loki'ye gönderiyorum. Grafana üzerinden hepsini rahatça arayabiliyorum.",
                
                obs_graf_desc: "Donanım, ağ ve uygulama durumlarını izlediğim ana ekranım.",
                
                img_graf_title: "Operasyonel Görünürlük:",
                img_graf_desc: "Proxmox sunucu kaynaklarının (CPU/RAM) ve bireysel LXC konteyner performansının gerçek zamanlı izlenmesi.",

                topo_title: "Ağ Topolojisi",
                topo_intro: "Hibrit bir ağ kurdum. Ailem evden hızlıca (yerel) bağlanırken, ben dışarıdan Cloudflare Tünelleri ile güvenli bir şekilde bağlanıyorum.",
                
                topo_tunnel: "Şifreli Cloudflare Tüneli (Gelen Port Kapalı)",
                
                img_npm_title: "Trafik Yönlendirme:",
                img_npm_desc: "Nginx Proxy Manager, SSL işlerini halleder ve gelen trafiği doğru konteynere yönlendirir.",

                virt_title: "Sanallaştırma Stratejisi",
                virt_intro: "İşletim sistemi gibi davranması gerekenler için LXC, uygulamalar için Docker kullanıyorum. Scriptlerim bu ikisinin uyumlu çalışması için gereken karmaşık ayarları hallediyor.",
                
                virt_dind_title: "LXC içinde Docker (Otomatik)",
                virt_dind_desc: "<code>lxc-manager.sh</code> scriptim, Docker'ın LXC içinde sorunsuz çalışması için gereken iç içe (nesting) ayarları otomatik yapar.",
                
                virt_gpu_title: "Otomatik GPU Passthrough",
                virt_gpu_desc: "Config dosyalarını elle düzenlemek yerine scriptim ekran kartını algılar ve gerekli izinleri LXC'ye otomatik tanımlar.",

                inv_title: "Canlı Envanter",
                inv_status: "Sistemler Operasyonel"
            }
        };

        let currentLang = localStorage.getItem('lang') || 'en';

        function updateContent() {
            // Update Text Elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (I18N[currentLang][key]) {
                    el.innerHTML = I18N[currentLang][key];
                }
            });

            // Update Switcher Button
            const btn = document.querySelector('.lang-switch span');
            if (currentLang === 'en') {
                btn.innerHTML = '<span class="lang-active">EN</span> / TR';
            } else {
                btn.innerHTML = 'EN / <span class="lang-active">TR</span>';
            }
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'tr' : 'en';
            localStorage.setItem('lang', currentLang);
            updateContent();
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateContent(); // Initial Render

            // --- LIGHTBOX LOGIC ---
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const screenshots = document.querySelectorAll('.screenshot-container img');

            screenshots.forEach(img => {
                img.addEventListener('click', () => {
                    lightboxImg.src = img.src;
                    lightbox.style.display = 'flex';
                });
            });

            lightbox.addEventListener('click', () => {
                lightbox.style.display = 'none';
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') lightbox.style.display = 'none';
            });

            // --- SCROLLSPY ---
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('section');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        navItems.forEach(item => item.classList.remove('active'));
                        const activeItem = document.querySelector(`.nav-links a[href="#${id}"]`);
                        if (activeItem) activeItem.classList.add('active');
                    }
                });
            }, { root: null, rootMargin: '-20% 0px -70% 0px', threshold: 0 });

            sections.forEach(section => observer.observe(section));

            // --- INVENTORY RENDER ---
            const grid = document.getElementById('stack-grid');
            if (typeof ARCHITECTURE_DATA !== 'undefined' && ARCHITECTURE_DATA.stacks) {
                grid.innerHTML = '';
                ARCHITECTURE_DATA.stacks.forEach(stack => {
                    const card = document.createElement('div');
                    card.className = 'inv-card';
                    
                    let headerColor = 'var(--text-muted)';
                    if (stack.category === 'Infrastructure') headerColor = 'var(--accent-orange)';
                    if (stack.category === 'Media') headerColor = 'var(--accent-green)';
                    if (stack.category === 'Utilities') headerColor = 'var(--accent-blue)';
                    
                    let servicesHtml = '';
                    stack.services.forEach(svc => {
                        let iconColor = 'var(--text-muted)';
                        if (svc.name.includes('Jellyfin') || svc.name.includes('Immich')) iconColor = 'var(--accent-green)';
                        servicesHtml += `
                            <div class="svc-row">
                                <div><i class="${svc.icon}" style="color:${iconColor}"></i> ${svc.name}</div>
                                <span>${svc.port}</span>
                            </div>
                        `;
                    });

                    let gpuBadge = stack.specs.gpu ? '<span class="badge gpu">GPU</span>' : '';

                    card.innerHTML = `
                        <div class="inv-header" style="border-left: 4px solid ${headerColor}">
                            <div>
                                <div style="font-weight:bold; font-size:0.95rem;">${stack.name}</div>
                                <div style="font-size:0.75rem; color:var(--text-muted); font-family:monospace;">${stack.ip}</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-size:0.75rem;">${stack.specs.cpu} CPU / ${stack.specs.ram}</div>
                                ${gpuBadge}
                            </div>
                        </div>
                        <div class="inv-body">${servicesHtml}</div>
                    `;
                    grid.appendChild(card);
                });
            }
        });
    </script>
</body>
</html>